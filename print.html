<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ASMTP</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="keynesis.html"><strong aria-hidden="true">2.</strong> Keynesis</a></li><li class="chapter-item expanded "><a href="noise.html"><strong aria-hidden="true">3.</strong> Noise</a></li><li class="chapter-item expanded "><a href="poldercast.html"><strong aria-hidden="true">4.</strong> Poldercast</a></li><li class="chapter-item expanded "><a href="asmtp.html"><strong aria-hidden="true">5.</strong> ASMTP</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">ASMTP</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p>Since the Coronavirus Pandemic that started end of 2019 the world has accelerated
even more the use of decentralized workforce. Students have been confined to study
from home. Yet we managed the stay connected. Connected with our colleagues, with
other students and teachers, with our communities. This is an amazing opportunity
for technology innovation.</p>
<p>However this is also an opportunity for organized crime or for authoritarian
governments to tighten their grip on their victims. Entire databases with
millions of users have been leaked<a href="https://www.theguardian.com/technology/2021/apr/03/500-million-facebook-users-website-hackers">\(^{1}\)</a>. This is worrisome as these
leaks contains information linking to our identities: email addresses, phone
numbers, address of residence, education, etc. From these information it is
possible to social engineer identity theft.</p>
<p>The only way is to improve the tools we have, to start respecting ourselves and
care more for our online identity, our privacy.</p>
<h1 id="the-cloak-of-dignity"><a class="header" href="#the-cloak-of-dignity">The cloak of dignity</a></h1>
<p>We are not the only one to have seen how it is crucial to address the problems
we are facing. Signal messaging application offers one of the most secure and
privacy preserving messaging protocol you can get. And for free! Or is it, really?</p>
<p>It seems that the goal of <code>Signal</code> has shifted from providing secure messaging
services to cryptocurrency<a href="https://signal.org/blog/help-us-test-payments-in-signal/">\(^{2}\)</a>. While this may seem okay for some it
has hurt some technologists around the world<a href="https://www.stephendiehl.com/blog/signal.html">\(^{3}\)</a>. Signal has also so
many flows, one of them is to rely on mobile operators to play nice as it still
relies heavily on the phone number of its users to authenticate them.</p>
<p>It comes down to the same problem as usual: how to authenticate users? Signal
and WhatsApp are relying on phone numbers, Facebook and many others are relying
on email addresses and passwords. We all know this is flawed in so many way.
Database are leaked. We are making ourselves dependent on Apple, Facebook, Google
or Microsoft to be the guardians of our digital identity. What if Apple decides
you should not use a specific service anymore? How ethical is it for them to
decide what their users should use or not.</p>
<h1 id="fear-not-for-there-is-hope"><a class="header" href="#fear-not-for-there-is-hope">Fear not for there is hope</a></h1>
<p>We have designed a new set of protocols to address these problems.</p>
<h2 id="a-hrefkeynesishtmlpassportpassporta-digital-identity"><a class="header" href="#a-hrefkeynesishtmlpassportpassporta-digital-identity"><a href="./keynesis.html#passport"><code>Passport</code></a>: Digital identity</a></h2>
<p><a href="./keynesis.html"><code>keynesis</code></a> is protocol to offer digital identity. It is leveraging modern
cryptography and the secure enclave we find on most devices to offer the
most secure way to manage your digital identity.</p>
<p><a href="./keynesis.html"><code>keynesis</code></a> defines all the necessary cryptographic protocols to maintain
what is going to identify you as an individual: <a href="./keynesis.html#passport"><code>Passport</code></a>.</p>
<p>Unlike Signal or Facebook, the authentication of users does not rely on
a third party. If you can access the device you have in your hands you can
authenticate yourself. Also the <a href="./keynesis.html#passport"><code>Passport</code></a> is completely anonymous. It does
not contains any information that may be used to identify an individual.
The only way to know a password is the password of Nicolas is if
Nicolas told you it is his and that he provided you the proof he control
keys registered in that <a href="./keynesis.html#passport"><code>Passport</code></a>.</p>
<h2 id="a-hrefasmtphtmlasmtpa-secret-and-private-messaging"><a class="header" href="#a-hrefasmtphtmlasmtpa-secret-and-private-messaging"><a href="./asmtp.html"><code>ASMTP</code></a>: Secret and private messaging</a></h2>
<p><a href="./asmtp.html"><code>ASMTP</code></a> stands for Anonymous and Secure Message Transfer Protocol. It is
one fo the many transport layer that can be used to leverage the use of
<a href="./keynesis.html"><code>keynesis</code></a>'s <a href="./keynesis.html#passport"><code>Passport</code></a>. It defines a message service that can be used
to propagate <a href="./keynesis.html#passport"><code>Passport</code></a>'s updates and messages between <a href="./keynesis.html#passport"><code>Passport</code></a>s.</p>
<p>One of the interesting aspect of <a href="./asmtp.html"><code>ASMTP</code></a> is that it offers anonymous message
passing between nodes of the network. Messages are passed nodes to nodes and
are propagated through the network following <a href="./poldercast.html"><code>poldercast</code></a>: the peer to peer
(P2P) pub/sub algorithm.</p>
<h1 id="keynesis"><a class="header" href="#keynesis">Keynesis</a></h1>
<p><code>keynesis</code> is the library used to provide construct the digital identity
of a user on the network. Simply put it defines how to links some
cryptographic keypair together and provides them rolls.</p>
<h2 id="keys"><a class="header" href="#keys">keys</a></h2>
<p>Keynesis uses EdDSA (Edwards-curve Digital Signature Algorithm)
as signing algorithm, it is rather small and fast and
a very secure protocol. We use Curve25519 for the Diffie-Hellman
key exchange. Ed25519 keys are composed of two part. Also called
Ed25519 key pair. There is a <code>private key</code> and a <code>public key</code>.</p>
<h3 id="signing"><a class="header" href="#signing">Signing</a></h3>
<p>Signature are create with the <code>private key</code> and can be verified
with the <code>public key</code>. The digital <code>signature</code> offers non-repudiation.
This means that the <code>private key</code> cannot deny the authenticity of the
<code>signature</code> and the <code>document</code> once shared.</p>
<pre class="mermaid">flowchart
    Prv(Private Key) -.-&gt; Pub(Public Key)
    Prv -- Generates --&gt; Signature
    Pub -- Verifies --&gt; Signature

    style Prv fill:#f9f,stroke:#333,stroke-width:4px
</pre>
<h3 id="key-exchange"><a class="header" href="#key-exchange">Key exchange</a></h3>
<p>Using a projection of the <code>Ed25519</code> keys we can perform a key exchange
(Diffie-Hellman key exchange). This allows to generate a shared secrets
between two parties without having to share anything more than
each other's public key.</p>
<p>For example: <strong>Alice</strong> generates a key pair, <strong>Bob</strong> generates a key pair.
<strong>Alice</strong> will combine her <code>private key</code> with <strong>Bob</strong>'s <code>public key</code> to generate
a shared secret. <strong>Bob</strong> will combine his <code>private key</code> with <strong>Alice</strong>'s
<code>public key</code> to generate the same shared secret.</p>
<blockquote>
<p>\( Dh(Priv^{Alice}, Pub^{Bob}) = Dh(Priv^{Bob}, Pub^{Alice}) \)</p>
</blockquote>
<pre class="mermaid">flowchart LR
    Aprv(Alice Private Key) -.-&gt; Apub(Alice Public Key)
    Bprv(Bob Private Key) -.-&gt; Bpub(Bob Public Key)

    Aprv --&gt; DH1{Key Exchange}
    Bpub --&gt; DH1


    Bprv --&gt; DH2{Key Exchange}
    Apub --&gt; DH2

    DH1 --&gt; SS&gt;Shared Secret]
    DH2 --&gt; SS

    style Aprv fill:#f9f,stroke:#333,stroke-width:4px
    style Bprv fill:#f9f,stroke:#333,stroke-width:4px
</pre>
<h2 id="passport"><a class="header" href="#passport">Passport</a></h2>
<p>A <code>passport</code> is defined as a set of <code>public key</code>s. Each <code>public key</code>
can represent a device of the user for example. Though it is not limited
to that only (one can add paper keys or HSM keys for example).</p>
<p>We use different keys in order to avoid asking the user to use a unique
passphrase across different devices. That a key is the one of a mobile
a desktop or a paper key is not known of the passport itself (though
it is possible to add an alias to the key to simplify the key management).</p>
<p>For example, a passport may be seen as a group of devices:</p>
<pre class="mermaid">graph BT
    subgraph Alice[Alice's Passport]
        a1[fa:fa-desktop desktop]
        a2[fa:fa-mobile mobile]
        a3[fa:fa-sticky-note paper key]
    end
</pre>
<p>Here Alice has registered the application on her desktop, on her mobile and
has also created a paper key.</p>
<p>If Alice registers to a webservice on her desktop. She
can automatically access the webservice with her mobile.</p>
<h3 id="passports-chain"><a class="header" href="#passports-chain">Passport's chain</a></h3>
<p>The passport is composed of a series of events: declaration of a new key,
repudiation of a key and more. This is a blockchain. Every blocks contains
the list of events (the updates to apply on the passport). Each blocks are
signed by any of the keys that are registered at the time of the block
creation. Each block referencing a previous block (hence the <em>chain</em>).</p>
<p>In order to create a new passport one simply creates a new block without
a previous block. Then new keys needs to be declared in order to allow
these keys to create blocks for the passport's chain.</p>
<pre class="mermaid">flowchart LR
    subgraph blockA
        a1[Register key1] --- a2
        a2[Register SharedKey1]
    end

    subgraph blockB
        b1[Register key2] --- b2
        b2[Register SharedKey2]
    end

    subgraph blockC
        c1[Repudiate key1] --- c2
        c2[Register SharedKey3]
    end

    blockA --&gt; blockB
    blockB --&gt; blockC
</pre>
<h3 id="passports-keys"><a class="header" href="#passports-keys">Passport's keys</a></h3>
<p>the passport's keys are all the keys that have been registered
in the passport chain and that have not been repudiated yet.</p>
<p>Any of the passport keys can submit a new block in the passport's
chain. Allowing to declare or repudiate new keys in the passport.
But also to generate a new <em>Shared Key</em> (see below) or any other
new event entries that may be defined later.</p>
<h3 id="passports-shared-key"><a class="header" href="#passports-shared-key">Passport's shared key</a></h3>
<p>The passport's keys are to maintain the state of the passport's chain.
Other protocols or interactions may requires to have other kind of
entries set in the passport's chain. Here we defines the passport's
<em>SharedKey</em>. It is a key that is encrypted for every other passport's
key. Every time a <em>SharedKey</em> is register it deprecates the use of the
previously declared _SharedKey_s.</p>
<p>The <code>SharedKey</code> are encrypted using the <a href="./noise.html#pattern-npsk0"><code>Npsk0</code></a> pattern of the noise protocol.
This allows to encrypt the data in such a way that only the recipient of
the key can retrieve the <code>SharedKey</code> if they also know the <em>pre shared key</em>.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let psk = ; // 32 bytes of pre shared key
let shared_secret_key = ; // curve25519 private key

for key in passport.keys() {
    let ephemeral = SecretKey::generate();

    let encrypted = noise::N::send(ephemeral, psk, key, shared_secret_key);
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="extending-the-passport-with-more-metadata"><a class="header" href="#extending-the-passport-with-more-metadata">Extending the passport with more metadata</a></h3>
<p>The <code>Passport</code> is a blockchain. So far we have defined only 3 types of <code>Event</code>s
supported by the <code>Passport</code>. Though it is perfectly conceivable to extend the
passport to add embed more data.</p>
<p>For example one could attach the digital signature of a document.</p>
<pre class="mermaid">graph LR
    subgraph Alice[Alice's Passport]
        a1[fa:fa-desktop desktop]
        a2[fa:fa-mobile mobile]
        a3[fa:fa-sticky-note-o paper key]
        a4[fa:fa-code signature]
    end

    document[fa:fa-id-card-o ID Card]

    a1 -- verify --&gt; a4
    a4 -- prove --&gt; document
</pre>
<p>If Alice had register an <code>ID Card</code> with her desktop's key. She then only need
to prove she owns any <em>keys</em> registered in her passport to prove the owns the
<code>Passport</code> which then proves that she is associated to the <code>ID Card</code>.</p>
<p>In this case we are not storing the <code>ID Card</code> document in the passport itself.
This would be to prevent proving our identity to everyone. Instead we want to
only show the <code>ID Card</code> to our convenience.</p>
<p>This is only an example of what could be added in the future. One could add
the signature of a diploma.</p>
<h1 id="noise"><a class="header" href="#noise">Noise</a></h1>
<p>The <a href="https://noiseprotocol.org">Noise Protocol</a> is a framework that we use for our cryptographic
protocols. It defines how to establish encrypted sessions between
senders and recipients.</p>
<blockquote>
<p>Noise protocols support mutual and optional authentication, identity hiding,
forward secrecy, zero round-trip encryption, and other advanced features.</p>
</blockquote>
<ul>
<li><em>mutual authentication</em>: it means all the participants are proving to
their identity to each others;</li>
<li><em>identity hiding</em>: means that no outside observer can find out the
identity of the participants;</li>
<li><em>forward secrecy</em>: it means that even if the long term keys of the participants
are compromised the session keys are protected as well as protecting the past
keys if the recent keys are compromised. In other words: we are protecting
the past communications.</li>
<li><em>zero round-trip encryption</em>: it is possible to send encrypted application
data to a recipient without prior exchanged messages.</li>
</ul>
<p>How the encrypted sessions are established is called Handshake Patterns. These
are the first sequence of messages the participants are to exchanged in order
to establish the encrypted session.</p>
<p>We are leveraging different of these handshake pattens in our protocols. These
patterns are described below.</p>
<h2 id="pattern-x"><a class="header" href="#pattern-x">Pattern: <code>X</code></a></h2>
<ul>
<li>✅ Mutual authentication</li>
<li>✅ Zero round trip encryption</li>
<li>✅ Identity hiding</li>
<li>❌ Forward secrecy</li>
</ul>
<p>This pattern allows for 0 round trip encryption. Yet it allows to authenticate
both the sender to the receiver (the sender's public key is transmitted in the
message -- encrypted). Only the recipient can retrieve the identity of the sender.</p>
<p>This type of message is used by <strong>ASMTP</strong> to encrypt the messages users will
send to each other. The <code>Public Key</code> used here are the <code>Shared Key</code> in Alice's
and Bob's respective passports.</p>
<h3 id="encrypting-the-message"><a class="header" href="#encrypting-the-message">encrypting the message</a></h3>
<pre class="mermaid">sequenceDiagram
    participant Alice
    participant Session
    participant Bob
    autonumber

    Bob--)Alice: Bob's Public Key

    Note over Alice,Session: Alice starts sending a message to Bob

    Alice-&gt;&gt;+Alice: generate ephemeral key
    Alice--&gt;&gt;Session: serialise ephemeral public key
    Alice-&gt;&gt;-Session: DH(ephemeral key, Bob's public key)
    
    Alice--&gt;&gt;Session: serialise Alice's Public Key
    Alice-&gt;&gt;Session: DH(Alice's Key, Bob's public key)

    Alice--&gt;&gt;Session: Encrypt payload
</pre>
<ol>
<li>Alice needs to know Bob's public key in advance;</li>
<li>Alice generates an ephemeral key. Its lifetime is limited to the configuration of the session and needs the key will need to be securely destroyed once no longer needed;</li>
<li>Alice sets the ephemeral public key in the session. It is serialized in the message payload and is used to update the encryption state of the session;</li>
<li>Alice sets the result of the key exchange (Diffie-Hellman: <em>DH</em>) between the ephemeral private key and Bob's public key. Alice can now destroy the ephemeral secret key.</li>
<li>Alice sets her public key in the session. It is serialized in the mesasge payload and is used to update the encryption state of the session;</li>
<li>Alice sets the result of the key exchange (Diffie-Hellman: <em>DH</em>) between her private key and Bob's public key.</li>
<li>Alice sets the payload to encrypt.</li>
</ol>
<h3 id="decrypting-the-message"><a class="header" href="#decrypting-the-message">decrypting the message</a></h3>
<pre class="mermaid">sequenceDiagram
    participant Session
    participant Bob
    autonumber

    Note over Session,Bob: Bob starts reading a message

    Session--&gt;&gt;Bob: deserialize ephemeral public key
    
    Bob-&gt;&gt;Session: DH(Bob's Key, Ephemeral's public key)

    Session--&gt;&gt;Bob: deserialize sender's public key

    Note over Bob,Session: Bob now knows the message is from Alice (sender's public key)

    Bob-&gt;&gt;Session: DH(Bob's Key, Sender's public key)
    Session--&gt;&gt;Bob: Decrypt payload
</pre>
<ol>
<li>Bob deserializes the ephemeral public key from the payload;</li>
<li>Bob sets the result of the key exchange (<em>DH</em>) between his private key and the deserialized ephemeral public key;</li>
<li>Bob deserializes the sender's public key.</li>
<li>Bob sets the result of the key exchange (<em>DH</em>) between his private key and the deserialized sender's public key;</li>
<li>Bob decrypts the payload</li>
</ol>
<p>More info on <a href="https://noiseexplorer.com/patterns/X/"><code>Noise's explorer</code></a></p>
<h2 id="pattern-npsk0"><a class="header" href="#pattern-npsk0">Pattern: <code>Npsk0</code></a></h2>
<ul>
<li>✅ Mutual authentication: thanks to the psk</li>
<li>✅ Zero round trip encryption: we only care about the recipient reading the message</li>
<li>✅ Identity hiding: it is not possible to know who are the participants of this exchange</li>
<li>❌ Forward secrecy: if the <code>psk</code> or the recipient keys are compromised the message is compromised</li>
</ul>
<p>This pattern is used to encrypt the shared secret key in the passport's blocks.
Using this pattern allows us to have a fairly small encrypted data
in the passport that requires only the extra ephemeral public key
to be stored along with the encrypted data.</p>
<h3 id="encrypting-the-message-1"><a class="header" href="#encrypting-the-message-1">encrypting the message</a></h3>
<pre class="mermaid">sequenceDiagram
    participant Alice
    participant Session
    participant Bob
    autonumber

    Bob--)Alice: Bob's Public Key

    Note over Alice,Session: Alice starts sending a message to Bob

    rect rgba(0, 0, 255, .1)
      Alice-&gt;&gt;Session: pre-shared secret (password)
    end

    Alice-&gt;&gt;+Alice: generate ephemeral key
    Alice--&gt;&gt;Session: serialise ephemeral public key
    
    Alice-&gt;&gt;-Session: DH(Ephemeral Key, Bob's public key)

    Alice--&gt;&gt;Session: Encrypt payload
</pre>
<ol>
<li>Alice needs to know Bob's public key in advance;</li>
<li>Alice sets a pre-shared secret, usually it can be a password for example. Bob will need to be aware of that secret too in order to decrypt the message;</li>
<li>Alice generates an ephemeral key. Its lifetime is limited to the configuration of the session and needs the key will need to be securely destroyed once no longer needed;</li>
<li>Alice sets the ephemeral public key in the session. It is serialized in the message payload and is used to update the encryption state of the session;</li>
<li>Alice sets the result of the key exchange (Diffie-Hellman: <em>DH</em>) between the ephemeral private key and Bob's public key. Alice can now destroy the ephemeral secret key.</li>
<li>Alice sets the payload to encrypt.</li>
</ol>
<h3 id="decrypting-the-message-1"><a class="header" href="#decrypting-the-message-1">decrypting the message</a></h3>
<pre class="mermaid">sequenceDiagram
    participant Session
    participant Bob
    autonumber

    Note over Session,Bob: Bob starts reading a message from Alice

    rect rgba(0, 0, 255, .1)
      Bob-&gt;&gt;Session: pre-shared secret (password)
    end

    Session--&gt;&gt;Bob: deserialise ephemeral public key
    
    Bob-&gt;&gt;Session: DH(Bob's Key, Ephemeral's public key)

    Session--&gt;&gt;Bob: Decrypt payload
</pre>
<ol>
<li>Bob sets the pre-shared secret, it needs to be the same as the one Alice used;</li>
<li>Bob deserializes the ephemeral public key from the payload;</li>
<li>Bob sets the result of the key exchange (<em>DH</em>) between his private key and the deserialized ephemeral public key;</li>
<li>Bob decrypts the payload</li>
</ol>
<p>More info on <a href="https://noiseexplorer.com/patterns/Npsk0/"><code>Noise's explorer</code></a></p>
<h2 id="pattern-ik"><a class="header" href="#pattern-ik">Pattern: <code>IK</code></a></h2>
<ul>
<li>✅ Mutual authentication</li>
<li>❌ Zero round trip encryption</li>
<li>✅ Identity hiding</li>
<li>✅ Forward secrecy</li>
</ul>
<p>In only one round trip we can establish the most secure form of encrypted
session available to us. The only prerequisite to establish this kind of
session is to know in advance the public key of the remote peer.</p>
<p>It starts exactly like the <code>X</code> pattern described previously. However we are
assuming the session to be finally started after another message is received
from the recipient.</p>
<p>This pattern is used to establish secure and long connections between nodes
on the network. The public keys used here are the same one serialised in the
<a href="./poldercast.html#gossips">poldercast's gossips</a>. This guarantees we are talking to the appropriate
nodes for the right reasons (see <a href="./poldercast.html">poldercast</a> for more details).</p>
<h3 id="encrypting-the-message-2"><a class="header" href="#encrypting-the-message-2">encrypting the message</a></h3>
<pre class="mermaid">sequenceDiagram
    participant Alice
    participant Session
    participant Bob
    autonumber

    Bob--)Alice: Bob's Public Key

    Note over Alice,Session: Alice starts sending a message to Bob

    Alice-&gt;&gt;+Alice: generate Alice's ephemeral key
    Alice--&gt;&gt;Session: serialise Alice's ephemeral public key
    Alice-&gt;&gt;Session: DH(Alice's ephemeral key, Bob's public key)
    
    Alice--&gt;&gt;Session: serialise Alice's Public Key
    Alice-&gt;&gt;Session: DH(Alice's Key, Bob's public key)

    Note over Session,Bob: Bob processes the message and replies

    Session--&gt;&gt;Alice: deserialize Bob's ephemeral public key
    Alice-&gt;&gt;-Session: DH(Alice's ephemeral key, Bob's ephemeral public key)
    Alice-&gt;&gt;Session: DH(Alice's key, Bob's ephemeral public key)
    

    par sending messages
      Alice--)Session: Encrypt payload
    and receiving messages
      Session--)Alice: Decrypt payload
    end
</pre>
<ol>
<li>Alice needs to know Bob's public key in advance;</li>
<li>Alice generates an ephemeral key. Its lifetime is limited to the configuration of the session and needs the key will need to be securely destroyed once no longer needed;</li>
<li>Alice sets Alice's ephemeral public key in the session. It is serialized in the message payload and is used to update the encryption state of the session;</li>
<li>Alice sets the result of the key exchange (Diffie-Hellman: <em>DH</em>) between Alice's ephemeral private key and Bob's public key.</li>
<li>Alice sets her public key in the session. It is serialized in the message payload and is used to update the encryption state of the session;</li>
<li>Alice sets the result of the key exchange (Diffie-Hellman: <em>DH</em>) between her private key and Bob's public key.</li>
<li>Alice deserializes Bob's ephemeral public key;</li>
<li>Alice sets the result of the key exchange (Diffie-Hellman: <em>DH</em>) between Alice's ephemeral private key and Bob's ephemeral public key. Alice's ephemeral key can now be securely destroyed.</li>
<li>Alice sets the result of the key exchange (Diffie-Hellman: <em>DH</em>) between Alice's private key and Bob's ephemeral public key.</li>
<li>Alice can use the session to send messages to Bob</li>
<li>Alice can use the session to receive messages from Bob</li>
</ol>
<h3 id="decrypting-the-message-2"><a class="header" href="#decrypting-the-message-2">decrypting the message</a></h3>
<pre class="mermaid">sequenceDiagram
    participant Session
    participant Bob
    autonumber

    Note over Session,Bob: Bob starts reading a message

    Session--&gt;&gt;Bob: deserialize sender's ephemeral public key
    
    Bob-&gt;&gt;Session: DH(Bob's Key, Sender's ephemeral public key)

    Session--&gt;&gt;Bob: deserialize sender's public key

    Note over Bob,Session: Bob now knows the message is from Alice (sender's public key)

    Bob-&gt;&gt;Session: DH(Bob's Key, Alice's public key)

    Bob-&gt;&gt;+Bob: generate Bob's ephemeral key
    Bob--&gt;&gt;Session: serialise Bob's ephemeral public key
    Bob-&gt;&gt;Session: DH(Bob's ephemeral key, Alice's ephemeral public key)
    Bob-&gt;&gt;-Session: DH(Bob's ephemeral key, Alice's public key)

    par sending messages
      Session--)Bob: Decrypt payload
    and receiving messages
      Bob--)Session: Encrypt payload
    end
</pre>
<ol>
<li>Bob deserializes the sender's ephemeral public key from the payload;</li>
<li>Bob sets the result of the key exchange (<em>DH</em>) between his private key and the sender's ephemeral public key;</li>
<li>Bob deserializes the sender's public key, we now know it is Alice.</li>
<li>Bob sets the result of the key exchange (<em>DH</em>) between his private key and Alice's public key;</li>
<li>Bob generates an ephemeral key. Its lifetime is limited to the configuration of the session and needs the key will need to be securely destroyed once no longer needed;</li>
<li>Bob sets Bob's ephemeral public key in the session. It is serialized in the message payload and is used to update the encryption state of the session;</li>
<li>Bob sets the result of the key exchange (Diffie-Hellman: <em>DH</em>) between Bob's ephemeral private key and Alice's ephemeral public key.</li>
<li>Bob sets the result of the key exchange (Diffie-Hellman: <em>DH</em>) between Bob's ephemeral private key and Alice's public key.</li>
<li>Bob can use the session to receive messages from Alice</li>
<li>Bob can use the session to send messages to Alice</li>
</ol>
<p>More info on <a href="https://noiseexplorer.com/patterns/IK/"><code>Noise's explorer</code></a></p>
<h1 id="poldercast"><a class="header" href="#poldercast">Poldercast</a></h1>
<p>Poldercast is our peer to peer (P2P) pub/sub algorithm. It defines how
nodes on the network are supposed to discover each others as well as
how events should be propagated from nodes to nodes in order to reach
the appropriate recipients.</p>
<p>You can find the paper here: <a href="https://hal.inria.fr/hal-01555561/document">Poldercast</a>.</p>
<p>Our implementation is here: <a href="https://github.com/primetype/poldercast#README.md"><code>poldercast</code></a>.</p>
<h2 id="gossips"><a class="header" href="#gossips">Gossips</a></h2>
<p>When connecting to the network the node generates a Gossip of itself.
It contains the necessary information to identify the node in the
network and the list of topic of interests.</p>
<p>In our implementation, the identification of the node necessitate two
types of information:</p>
<ul>
<li>the ip address (ipv4 or ipv6) with the port number;</li>
<li>the <a href="./keynesis.html#keys">ed25519 public key</a> of the node</li>
</ul>
<p>The Gossip also embeds a timestamp as well as a signature generated
with the node's private key. This allows us to know the data is the
one that was originally generated by this private key associated to
this public key (see <a href="./keynesis.html#signing">key and signature</a>).</p>
<h2 id="topics-of-interest"><a class="header" href="#topics-of-interest">Topics of interest</a></h2>
<p>The topic of interest is a list of nodes topic identifier (<code>topic</code>)
with an interest level. This allows for each nodes to prioritize
how much priority they put to some set of information.</p>
<p>The topics is an array of 32 bytes. It can be derived from a <code>hash</code>
of something else. A static value or a public key. This allows for
a large size of different topics to exist on the network and should
provide enough space for everyone to exist on the network.</p>
<h2 id="poldercast-layers"><a class="header" href="#poldercast-layers">Poldercast Layers</a></h2>
<p>Poldercast algorithm can be simply described as 3 different layers.</p>
<p>One of these layers is called the <code>ring</code> layer and is responsible to define how
events of certain topic are supposed to be distributed based on the
identifier of the node.</p>
<p>There is also the <code>vicinity</code> layer that is responsible to find
nodes that have similar interests (based on the topics of interest of
our nodes and the other nodes of the network).</p>
<p>Finally there is the <code>cyclon</code> layer that is responsible to randomly
sample nodes on the network.</p>
<h1 id="asmtp"><a class="header" href="#asmtp">ASMTP</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="mermaid.min.js"></script>
        
        <script type="text/javascript" src="mermaid-init.js"></script>
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
        
        

    </body>
</html>
